FROM ubuntu:18.04
LABEL Description="Build environment"

ENV HOME /root

SHELL ["/bin/bash", "-c"]

RUN echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections && \
    apt-get update && apt-get -y --no-install-recommends install \
    build-essential \
    clang \
    cmake \
    gdb \
    wget

# Add dependency
RUN cd ${HOME} && \
    DEBIAN_FRONTEND=noninteractive apt-get update && apt-get install -y apt-utils && \
    wget --no-check-certificate --quiet https://boostorg.jfrog.io/artifactory/main/release/1.77.0/source/boost_1_77_0.tar.gz && \
    tar xzf ./boost_1_77_0.tar.gz && \
    cd ./boost_1_77_0 && \
    ./bootstrap.sh && \
    ./b2 install && \
    cd .. && \
    rm -rf ./boost_1_77_0

RUN cd ${HOME} && \
    apt-get purge --auto-remove -y cmake && \
    DEBIAN_FRONTEND=noninteractive apt-get update && apt-get install -y software-properties-common lsb-release && apt-get clean all && \
    wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2>/dev/null | gpg \
        --dearmor - | tee /etc/apt/trusted.gpg.d/kitware.gpg >/dev/null && \
    apt-add-repository "deb https://apt.kitware.com/ubuntu/ $(lsb_release -cs) main" && \
    DEBIAN_FRONTEND=noninteractive apt-get update && apt-get install -y libcurl4-openssl-dev libsqlite3-dev curl && \
    curl -fsS https://dlang.org/install.sh | bash -s dmd && \
    apt-get -y install kitware-archive-keyring && \
    rm /etc/apt/trusted.gpg.d/kitware.gpg && \
    apt-get install cmake -y && cmake --version
